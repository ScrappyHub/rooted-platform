## 5ï¸âƒ£ ROOTED_PRE-LAUNCH_ABUSE_TEST_MATRIX.md  
ğŸ“ **File:** `/docs/ROOTED_PRE-LAUNCH_ABUSE_TEST_MATRIX.md`

```md
# ğŸ§ª ROOTED â€” PRE-LAUNCH ABUSE TEST MATRIX (CANONICAL v1)

Cross-References:

- /governance/ROOTED_PLATFORM_CONSTITUTION.md  
- /governance/ROOTED_ACCESS_POWER_LAW.md  
- /governance/ROOTED_KIDS_MODE_GOVERNANCE.md  
- /governance/ROOTED_SANCTUARY_NONPROFIT_LAW.md  
- /governance/ENFORCEMENT_MATRIX.md  
- /docs/Moderation_System.md  
- /docs/SECURITY.md  

Purpose:  

> Simulate malicious, negligent, and edge-case behavior across all trust surfaces **before** any real users touch ROOTED.

Rule:

> If any test passes incorrectly â†’ **launch must pause** until fixed.

---

## ğŸ” 1. ACCOUNT & ROLE ABUSE TESTS

### 1.1 Unauthorized Role Escalation

**Test:**

- Log in as a normal user  
- Attempt direct SQL / API call:  

```sql
UPDATE public.user_tiers SET role = 'admin';
Expected Result:

âŒ RLS blocks

âŒ No update occurs

âœ… Error returned / logged

1.2 Feature Flag Self-Unlock
Test:

Non-admin tries:

sql
Copy code
UPDATE public.user_tiers SET feature_flags = '{"construction_access": true}';
Expected:

âŒ Blocked by RLS

âœ… Only admin_update_feature_flags() is allowed to mutate flags

1.3 Account Status Bypass
Test:

Suspend a test account (account_status = 'suspended')

Try:

Posting

Messaging

Submitting events

Submitting vendor applications

Expected:

âŒ All actions blocked

âœ… UI and API both enforce suspended status

ğŸ§¾ 2. ADMIN ABUSE + AUDIT TAMPERING
2.1 Silent Admin Action
Test:

Admin attempts raw:

sql
Copy code
UPDATE public.user_tiers SET tier = 'premium_plus';
Expected:

âŒ Raw update should either be blocked or clearly identified as bypass

ğŸš¨ If no audit row is created in user_admin_actions â†’ this is a FAIL

âœ… Correct path: all admin mutations go through RPCs that log to user_admin_actions

2.2 Audit Log Deletion
Test:

sql
Copy code
DELETE FROM public.user_admin_actions;
Expected:

âŒ Blocked by RLS / constraints

âœ… Append-only behavior holds

2.3 Admin Acting While Suspended
Test:

Set adminâ€™s account_status = 'suspended'

Try calling admin_set_account_status()

Expected:

âŒ Blocked

âœ… public.is_admin() requires both:

role = 'admin'

account_status = 'active'

ğŸ§­ 3. MODERATION BYPASS TESTS (CRITICAL)
3.1 Event Visibility Without Approval
Test:

Insert an event with moderation_status = 'pending'

Query via:

sql
Copy code
SELECT * FROM public.events_public_v1;
Expected:

âœ… Event does not appear

3.2 Direct Table Bypass Attempt
Test:

From anon or standard authenticated client, attempt:

sql
Copy code
SELECT * FROM public.events;
Expected:

âŒ RLS blocks or returns only allowed user-owned rows

âœ… Frontend never points directly to raw events for public discovery

3.3 Fake Approval Attempt
Test:

sql
Copy code
UPDATE public.events SET moderation_status = 'approved';
Expected:

âŒ Blocked unless internal service-role or maintenance function

âœ… Only admin_moderate_submission() can legally move an item to approved/rejected

ğŸ§’ 4. KIDS MODE SAFETY ABUSE TESTS (SUPREME CLAUSE)
4.1 API Kids Mode Bypass
Test:

Force Kids Mode OFF (kids_mode_enabled() = false)

Call any Kids-only RPC

Expected:

âŒ Hard exception or explicit rejection

âœ… No â€œUI-onlyâ€ enforcement allowed; backend enforces Kids Mode boundaries

4.2 Unsafe Content Flag Injection
Test:

Submit an unsafe event but mark is_kids_safe = true

Expected:

âœ… Still blocked until moderation approval

âœ… Admin review overrides submitter flags; Kids Mode never trusts self-marking alone

4.3 Landmark Kids Leakage
Test:

Create landmark with is_kids_safe = false

Query Kids landmarks view

Expected:

âœ… Landmark never appears in Kids views

ğŸ¾ 5. SANCTUARY / NONPROFIT PROTECTION TESTS
5.1 Sanctuary Marketplace Access
Test:

Sanctuary vendor attempts to:

Create RFQ

Submit bid

Create bulk offer

Expected:

âŒ All blocked via feature flags + compliance overlays

âœ… Sanctuary law enforced in RLS and views

5.2 Sanctuary Ad Monetization Attempt
Test:

Attempt to attach:

Ads

Sponsored content

Paid promotions

Expected:

âŒ Blocked at schema and UI

âœ… Sanctuary entities remain mission-only (volunteer + education)

ğŸ›ï¸ 6. MUNICIPAL DISCOVERY HIBERNATION
6.1 Civic Entity in Community Discovery
Test:

Insert civic provider with provider_type = 'municipal'

Attempt discovery via Community public views

Expected:

âœ… Hidden by default

âœ… Only appears later in dedicated government/civic verticals

âš’ï¸ 7. PROVIDER AUTO-INHERITANCE TESTS
7.1 Specialty Compliance Injection
Test:

Create provider with specialty = 'ELECTRICIAN'

Expected Auto-Attached Overlays:

âœ… LICENSE_REQUIRED

âœ… INSURANCE_REQUIRED

âœ… Optional overlay like OSHA awareness if defined

7.2 Kids Overlay Auto-Mapping
Test:

Specialty = FARM

Kids Mode ON

Expected:

âœ… ANIMAL_EDUCATION overlay auto-attached

âœ… FOOD_SYSTEMS overlay attached

ğŸ”” 8. NOTIFICATION ABUSE TESTS
8.1 Double Approval Spam
Test:

Call:

sql
Copy code
select public.admin_moderate_submission('<MOD_ID>', 'approved', 'ok');
select public.admin_moderate_submission('<MOD_ID>', 'approved', 'ok again');
Expected:

âœ… Second attempt:

Does nothing, or

Raises duplicate-state warning

âŒ No duplicate notifications sent to user

8.2 Private Rejection Reason Leak
Test:

Reject submission with detailed internal reason

Attempt to view this reason as some other user

Expected:

âœ… Only submitter and admins see full reason text

âŒ No leakage into public APIs or unrelated accounts

ğŸ’£ 9. DELETION PIPELINE ABUSE
9.1 Raw User Delete
Test:

sql
Copy code
DELETE FROM auth.users WHERE id = '<user>';
Expected:

âŒ Blocked in normal workflows

âœ… Only controlled deletion pipeline is used (account_deletion_requests + admin processing)

9.2 Post-Deletion Access
Test:

User marked in pending_deletions / deletion pipeline

Try to:

Post

Message

Submit events

Apply as vendor

Expected:

âŒ All actions blocked

ğŸŒ 1ï¸âƒ£0. PUBLIC DISCOVERY FINAL FIREWALL
10.1 Map Query
Test:

Load public map view

Inspect underlying query or sample results

Expected:

âœ… Every result satisfies moderation_status = 'approved'

âœ… Hidden/suspended entities never appear

10.2 Search Results
Test:

Run keyword search across directory

Expected:

âœ… Does not return:

Pending entities

Rejected entities

Suspended providers

âœ… PASS / FAIL CERTIFICATION
Only when all tests pass:

âœ… Governance Safe

âœ… Kids Safe

âœ… Civic-Trust Safe

âœ… Legal Safe

âœ… Abuse-Resistant

ğŸ¯ Only then may ROOTED go live.
