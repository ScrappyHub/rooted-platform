ğŸ§ª ROOTED â€” PRE-LAUNCH ABUSE TEST MATRIX (CANONICAL v1)

Purpose:
Simulate malicious, negligent, and edge-case behavior across all trust surfaces before any real users touch ROOTED.

Rule:
If any test passes incorrectly â†’ launch must pause until fixed.

ğŸ” 1. ACCOUNT & ROLE ABUSE TESTS
1.1 Unauthorized Role Escalation

Test:

Log in as a normal user

Attempt direct SQL / API call:

UPDATE public.user_tiers SET role = 'admin';


Expected Result:

âŒ RLS blocks

âŒ No update occurs

âœ… Error returned

1.2 Feature Flag Self-Unlock

Test:

Non-admin tries:

UPDATE public.user_tiers SET feature_flags = '{"construction_access": true}';


Expected:

âŒ Blocked by RLS

âœ… Only admin_update_feature_flags() allowed

1.3 Account Status Bypass

Test:

Suspend a test account

Try:

Posting

Messaging

Submitting events

Submitting vendor applications

Expected:

âŒ All actions blocked

âœ… UI + API both enforce

ğŸ§¾ 2. ADMIN ABUSE + AUDIT TAMPERING
2.1 Silent Admin Action

Test:

Admin attempts raw:

UPDATE public.user_tiers SET tier = 'premium_plus';


Expected:

âŒ Operation allowed ONLY if RLS allows

ğŸš¨ But no audit row created â†’ this is a FAIL

âœ… All admin mutations must go through RPCs with logging

2.2 Audit Log Deletion

Test:

DELETE FROM public.user_admin_actions;


Expected:

âŒ Blocked

âœ… Append-only behavior holds

2.3 Admin Acting While Suspended

Test:

Set an adminâ€™s account_status = 'suspended'

Try calling admin_set_account_status()

Expected:

âŒ Blocked

âœ… public.is_admin() enforces both:

role = admin

account_status = active

ğŸ§­ 3. MODERATION BYPASS TESTS (CRITICAL)
3.1 Event Visibility Without Approval

Test:

Insert an event with:

moderation_status = 'pending'


Query through:

SELECT * FROM public.events_public_v1;


Expected:

âœ… Event does NOT appear

3.2 Direct Table Bypass Attempt

Test:

Query:

SELECT * FROM public.events;


from anon or authenticated user

Expected:

âŒ RLS blocks or returns limited results

âœ… Frontend must never point to raw tables

3.3 Fake Approval Attempt

Test:

UPDATE public.events SET moderation_status='approved';


Expected:

âŒ Blocked unless internal service or RPC

âœ… Only admin_moderate_submission() allowed

ğŸ§’ 4. KIDS MODE SAFETY ABUSE TESTS (SUPREME CLAUSE)
4.1 API Kids Mode Bypass

Test:

kids_mode_enabled() = false

Call any kids-only RPC

Expected:

âŒ Hard exception thrown

âœ… No UI-only enforcement allowed

4.2 Unsafe Content Flag Injection

Test:

Submit unsafe event with:

is_kids_safe = true


Expected:

âœ… Still blocked until moderation approval

âœ… Moderation overrides submitter flags

4.3 Landmark Kids Leakage

Test:

Create landmark:

is_kid_safe = false


Query kids view

Expected:

âœ… Never appears

ğŸ¾ 5. SANCTUARY / NONPROFIT PROTECTION TESTS
5.1 Sanctuary Marketplace Access

Test:

Sanctuary vendor attempts to:

Create RFQ

Submit bid

Create bulk offer

Expected:

âŒ All blocked via feature flags + compliance overlays

5.2 Sanctuary Ad Monetization Attempt

Test:

Attempt to attach:

Ads

Sponsored content

Paid promotions

Expected:

âŒ Blocked at schema + UI

âœ… Mission-only behavior enforced

ğŸ›ï¸ 6. MUNICIPAL DISCOVERY HIBERNATION
6.1 Civic Entity in Community Discovery

Test:

Insert civic provider

Set:

provider_type = 'municipal'


Attempt discovery via Community views

Expected:

âœ… Hidden by default

âœ… Only appears in Government vertical later

âš’ï¸ 7. PROVIDER AUTO-INHERITANCE TESTS
7.1 Specialty Compliance Injection

Test:

Create provider with:

specialty = 'ELECTRICIAN'


Expected Auto-Attached Overlays:

âœ… LICENSE_REQUIRED

âœ… INSURANCE_REQUIRED

âœ… OSHA awareness (if seeded)

7.2 Kids Overlay Auto-Mapping

Test:

Specialty = FARM

Kids Mode ON

Expected:

âœ… ANIMAL_EDUCATION overlay auto-attached

âœ… FOOD_SYSTEMS overlay attached

ğŸ”” 8. NOTIFICATION ABUSE TESTS
8.1 Double Approval Spam

Test:

Attempt:

admin_moderate_submission(...approved...)
admin_moderate_submission(...approved...) again


Expected:

âœ… Second attempt either:

Does nothing

Raises duplicate state warning

âŒ No duplicate notifications sent

8.2 Private Rejection Reason Leak

Test:

Reject submission with internal reason

Attempt to view reason as another user

Expected:

âœ… Only submitter + admins see it

ğŸ’£ 9. DELETION PIPELINE ABUSE
9.1 Raw User Delete

Test:

DELETE FROM auth.users WHERE id = '<user>';


Expected:

âŒ Blocked

âœ… Only deletion pipeline allowed

9.2 Post-Deletion Access

Test:

User in pending_deletion

Try to:

Post

Message

Submit events

Apply as vendor

Expected:

âŒ All blocked

ğŸŒ 10. PUBLIC DISCOVERY FINAL FIREWALL
10.1 Map Query

Test:

Load public map

Verify all results satisfy:

moderation_status = 'approved'

10.2 Search Results

Test:

Keyword search

Expected:

âœ… Does NOT return:

Pending

Rejected

Suspended providers

âœ… PASS/FAIL CERTIFICATION

Only when ALL tests pass:

âœ… Governance Safe
âœ… Kids Safe
âœ… Civic-Trust Safe
âœ… Legal Safe
âœ… Abuse-Resistant

ğŸ¯ ROOTED MAY GO LIVE
